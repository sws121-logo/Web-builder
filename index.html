<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Dynamic Website Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Icon Library (Lucide) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .template-card { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .template-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        #preview-iframe { width: 100%; height: 100%; border: none; background-color: white; }
        .customization-panel { width: 380px; }
        .chatbot-container { width: 350px; height: 450px; transition: all 0.3s ease-in-out; }
        .selected-element { outline: 2px dashed #3B82F6 !important; outline-offset: 2px; cursor: pointer; }
        .selected-section { outline: 2px solid #10B981 !important; outline-offset: 2px; }
        .tab-button { transition: all 0.2s ease; }
        .tab-button.active { border-color: #3B82F6; color: #3B82F6; background-color: #EFF6FF; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 antialiased">

    <!-- Template Selection Screen -->
    <div id="template-selection" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-2xl p-8 max-w-6xl w-full">
            <h2 class="text-3xl font-bold text-center mb-2">Choose Your Website's Foundation</h2>
            <p class="text-center text-gray-500 mb-8">Each template comes with a complete, ready-to-edit structure.</p>
            <div id="template-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 overflow-y-auto max-h-[70vh] p-2">
                <!-- Templates injected by JS -->
            </div>
        </div>
    </div>

    <!-- Main Builder Interface -->
    <div id="builder-interface" class="hidden flex h-screen">
        <!-- Customization Panel -->
        <aside class="customization-panel bg-white shadow-lg flex flex-col">
            <div class="p-4 border-b">
                <h3 class="text-xl font-bold text-gray-900">Site Customizer</h3>
            </div>
            <!-- Tabs -->
            <div class="flex border-b">
                <button class="tab-button active flex-1 p-3 font-semibold text-sm" data-tab="pages">Pages & Sections</button>
                <button class="tab-button flex-1 p-3 font-semibold text-sm" data-tab="add">Add Elements</button>
                <button class="tab-button flex-1 p-3 font-semibold text-sm" data-tab="edit">Edit Element</button>
            </div>
            <div class="flex-grow overflow-y-auto">
                <!-- Pages & Sections Tab -->
                <div id="tab-content-pages" class="p-6">
                    <h4 class="text-lg font-semibold mb-4 text-gray-800">Pages</h4>
                    <div id="pages-list" class="space-y-2 mb-4"></div>
                    <button id="add-page-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors text-sm">Add New Page</button>
                    <hr class="my-6">
                    <h4 class="text-lg font-semibold mb-4 text-gray-800">Page Sections</h4>
                    <div class="space-y-2">
                        <button class="section-selector w-full text-left p-3 bg-gray-100 hover:bg-gray-200 rounded-lg" data-section="header">Header</button>
                        <button class="section-selector w-full text-left p-3 bg-gray-100 hover:bg-gray-200 rounded-lg" data-section="main">Body (Main)</button>
                        <button class="section-selector w-full text-left p-3 bg-gray-100 hover:bg-gray-200 rounded-lg" data-section="footer">Footer</button>
                    </div>
                </div>
                <!-- Add Elements Tab -->
                <div id="tab-content-add" class="p-6 hidden">
                    <h4 class="text-lg font-semibold mb-4 text-gray-800">Content Blocks</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <button class="add-element-btn" data-type="h1"><strong>H1</strong><span>Heading</span></button>
                        <button class="add-element-btn" data-type="p"><strong>P</strong><span>Paragraph</span></button>
                        <button class="add-element-btn" data-type="img">üñºÔ∏è<span>Image</span></button>
                        <button class="add-element-btn" data-type="button">üîò<span>Button</span></button>
                        <button class="add-element-btn" data-type="div">üî≤<span>Container</span></button>
                    </div>
                    <h4 class="text-lg font-semibold my-4 text-gray-800">Functional</h4>
                    <div class="grid grid-cols-2 gap-4">
                         <button class="add-element-btn" data-type="search">üîç<span>Search Bar</span></button>
                         <button class="add-element-btn" data-type="cart">üõí<span>Cart Icon</span></button>
                         <button class="add-element-btn" data-type="user">üë§<span>User Icon</span></button>
                    </div>
                </div>
                <!-- Edit Element Tab -->
                <div id="tab-content-edit" class="p-6 hidden">
                    <div id="element-properties">
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <p class="text-gray-500 mt-2">Click an element in the preview to edit.</p>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Live Preview -->
        <main class="flex-1 flex flex-col bg-gray-200">
            <header class="bg-white shadow-md p-3 flex justify-between items-center z-10">
                <div>
                    <h2 class="text-lg font-semibold text-gray-800">Live Preview: <span id="current-page-name" class="font-bold text-blue-600"></span></h2>
                </div>
                <div class="flex items-center space-x-2">
                    <button id="export-html-btn" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Export HTML</button>
                    <button id="preview-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Full Preview</button>
                </div>
            </header>
            <div class="flex-1 p-4">
                <div class="bg-white h-full shadow-lg rounded-lg overflow-hidden">
                    <iframe id="preview-iframe"></iframe>
                </div>
            </div>
        </main>

        <!-- AI Chatbot -->
        <div id="chatbot-toggle" class="fixed bottom-5 right-5 bg-blue-600 hover:bg-blue-700 text-white w-16 h-16 rounded-full flex items-center justify-center cursor-pointer shadow-lg transform hover:scale-110 transition-transform">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
        </div>
        <div id="chatbot-container" class="chatbot-container fixed bottom-24 right-5 bg-white rounded-lg shadow-xl hidden flex-col">
            <div class="bg-blue-600 text-white p-4 rounded-t-lg flex justify-between items-center">
                <h3 class="font-bold">AI Content Assistant</h3>
                <button id="close-chatbot" class="text-white">&times;</button>
            </div>
            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto bg-gray-50"></div>
            <div class="p-4 border-t">
                <div class="relative">
                    <input type="text" id="chat-input" class="w-full border rounded-lg p-2 pr-10" placeholder="Ask for content ideas...">
                    <button id="chat-send" class="absolute right-2 top-1/2 -translate-y-1/2 text-blue-500 hover:text-blue-700">‚û§</button>
                </div>
            </div>
        </div>
    </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- TEMPLATE DATA (Now with full structure and images) ---
            const templates = {
                'e-commerce': {
                    name: 'Modern E-commerce',
                    category: 'E-commerce',
                    html: `
                        <header class="bg-white shadow-md p-4 flex justify-between items-center sticky top-0">
                            <h1 class="text-2xl font-bold text-gray-800">Shopify</h1>
                            <nav class="hidden md:flex space-x-6 text-gray-600">
                                <a href="#" class="hover:text-blue-500">New Arrivals</a>
                                <a href="#" class="hover:text-blue-500">Men</a>
                                <a href="#" class="hover:text-blue-500">Women</a>
                            </nav>
                            <div class="flex items-center space-x-4">
                                <i data-lucide="search" class="cursor-pointer"></i>
                                <i data-lucide="shopping-cart" class="cursor-pointer"></i>
                                <i data-lucide="user" class="cursor-pointer"></i>
                            </div>
                        </header>
                        <main>
                            <section class="bg-gray-100 text-center py-20">
                                <h2 class="text-5xl font-bold">Summer Collection is Here</h2>
                                <p class="text-xl text-gray-600 mt-4">Discover the latest trends and styles for this season.</p>
                                <button class="mt-8 bg-blue-600 text-white py-3 px-8 rounded-lg text-lg font-semibold">Shop Now</button>
                            </section>
                            <section class="py-16 container mx-auto">
                                <h3 class="text-3xl font-bold text-center mb-10">Featured Products</h3>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                                    <div class="text-center"><img src="https://placehold.co/400x400/F3F4F6/333?text=Product+1" class="w-full h-auto rounded-lg mb-4"/><strong>Classic Tee</strong><p>$29.99</p></div>
                                    <div class="text-center"><img src="https://placehold.co/400x400/E5E7EB/333?text=Product+2" class="w-full h-auto rounded-lg mb-4"/><strong>Denim Jeans</strong><p>$79.99</p></div>
                                    <div class="text-center"><img src="https://placehold.co/400x400/D1D5DB/333?text=Product+3" class="w-full h-auto rounded-lg mb-4"/><strong>Sneakers</strong><p>$129.99</p></div>
                                </div>
                            </section>
                        </main>
                        <footer class="bg-gray-800 text-white py-10">
                            <div class="container mx-auto text-center">
                                <p>&copy; 2025 Shopify. All Rights Reserved.</p>
                            </div>
                        </footer>
                    `
                },
                'business': {
                    name: 'Corporate Business',
                    category: 'Business',
                    html: `
                        <header class="bg-white shadow-sm">
                            <nav class="container mx-auto p-4 flex justify-between items-center">
                                <div class="font-bold text-2xl text-blue-600">Innovate Inc.</div>
                                <div class="space-x-8"><a href="#">Home</a><a href="#">About</a><a href="#">Services</a><a href="#">Contact</a></div>
                            </nav>
                        </header>
                        <main>
                            <section class="py-24 text-center bg-blue-600 text-white">
                                <h2 class="text-5xl font-extrabold">Driving Growth Through Innovation</h2>
                                <p class="mt-4 text-lg">We provide strategic solutions for today's complex business challenges.</p>
                            </section>
                             <section class="py-16 container mx-auto text-center">
                                <h3 class="text-3xl font-bold mb-10">Our Core Services</h3>
                                <div class="grid md:grid-cols-3 gap-10">
                                    <div><img src="https://placehold.co/400x300/E0F2FE/0284C7?text=Strategy" class="rounded-lg mb-4"/><h4>Business Strategy</h4></div>
                                    <div><img src="https://placehold.co/400x300/CFFAFE/0284C7?text=Marketing" class="rounded-lg mb-4"/><h4>Digital Marketing</h4></div>
                                    <div><img src="https://placehold.co/400x300/BAE6FD/0284C7?text=Analytics" class="rounded-lg mb-4"/><h4>Data Analytics</h4></div>
                                </div>
                            </section>
                        </main>
                        <footer class="bg-gray-900 text-white py-8 text-center">
                            <p>Innovate Inc. &copy; 2025</p>
                        </footer>
                    `
                },
                'portfolio': {
                    name: 'Creative Portfolio',
                    category: 'Portfolio',
                    html: `
                        <header class="p-8 flex justify-between items-center">
                            <div class="font-mono text-lg">JOHN DOE</div>
                            <nav class="space-x-6"><a href="#">Work</a><a href="#">About</a><a href="#">Contact</a></nav>
                        </header>
                        <main class="container mx-auto p-8">
                            <section class="text-center py-16">
                                <h1 class="text-6xl font-bold">Designer & Developer</h1>
                                <p class="text-2xl text-gray-500 mt-4">Creating beautiful and functional web experiences.</p>
                            </section>
                            <section class="py-16 grid grid-cols-2 gap-8">
                                <img src="https://placehold.co/600x400/111827/FFF?text=Project+Alpha" class="rounded-lg"/>
                                <img src="https://placehold.co/600x400/374151/FFF?text=Project+Beta" class="rounded-lg"/>
                                <img src="https://placehold.co/600x400/6B7280/FFF?text=Project+Gamma" class="rounded-lg"/>
                                <img src="https://placehold.co/600x400/9CA3AF/FFF?text=Project+Delta" class="rounded-lg"/>
                            </section>
                        </main>
                        <footer class="text-center py-8 border-t">
                            <p>John Doe &copy; 2025</p>
                        </footer>
                    `
                },
                'blog': {
                    name: 'Minimalist Blog',
                    category: 'Blog',
                    html: `
                        <header class="text-center py-12 border-b">
                            <h1 class="text-5xl font-serif">The Daily Chronicle</h1>
                            <p class="text-gray-500 mt-2">Thoughts, stories, and ideas.</p>
                        </header>
                        <main class="container mx-auto p-8 max-w-4xl">
                            <article class="mb-12">
                                <img src="https://placehold.co/800x400/F3F4F6/333?text=Blog+Post+Image" class="rounded-lg mb-6"/>
                                <h2 class="text-3xl font-bold mb-2">My First Post</h2>
                                <p class="text-gray-500 mb-4">Published on August 27, 2025</p>
                                <p class="text-lg leading-relaxed">This is the beginning of my new blog. Here, I'll share my thoughts on technology, design, and life. Stay tuned for more content soon!</p>
                            </article>
                        </main>
                        <footer class="text-center py-8 border-t mt-12">
                            <p>&copy; 2025 The Daily Chronicle</p>
                        </footer>
                    `
                }
            };

            // --- STATE MANAGEMENT ---
            let projectData = {
                pages: [],
                currentPageIndex: 0,
            };
            let iframeDoc;
            let selectedElement = null;
            let currentTab = 'pages';

            // --- UI ELEMENT REFERENCES ---
            const templateGrid = document.getElementById('template-grid');
            const builderInterface = document.getElementById('builder-interface');
            const previewIframe = document.getElementById('preview-iframe');
            const elementPropertiesPanel = document.getElementById('element-properties');
            const pagesList = document.getElementById('pages-list');
            const currentPageNameEl = document.getElementById('current-page-name');
            
            // --- INITIALIZATION ---
            function init() {
                populateTemplates();
                attachEventListeners();
            }

            function populateTemplates() {
                Object.values(templates).forEach(template => {
                    const card = document.createElement('div');
                    card.className = 'template-card bg-white rounded-lg shadow-md overflow-hidden cursor-pointer border hover:border-blue-500';
                    card.innerHTML = `
                        <img src="https://placehold.co/400x250/E5E7EB/4B5563?text=${template.name.replace(' ', '+')}" class="w-full h-auto"/>
                        <div class="p-4">
                            <h3 class="font-semibold text-lg">${template.name}</h3>
                            <p class="text-gray-500 text-sm">${template.category}</p>
                        </div>
                    `;
                    card.addEventListener('click', () => selectTemplate(template.html));
                    templateGrid.appendChild(card);
                });
            }

            function selectTemplate(html) {
                document.getElementById('template-selection').classList.add('hidden');
                builderInterface.classList.remove('hidden');
                projectData.pages = [{ name: 'Home', html }];
                projectData.currentPageIndex = 0;
                renderPageList();
                loadPage(0);
            }

            // --- PAGE MANAGEMENT ---
            function loadPage(pageIndex) {
                projectData.currentPageIndex = pageIndex;
                const page = projectData.pages[pageIndex];
                const fullHtml = `
                    <html><head><script src="https://cdn.tailwindcss.com"><\/script><script src="https://unpkg.com/lucide@latest"><\/script><style>body{font-family:'Inter',sans-serif}.selected-element{outline:2px dashed #3B82F6 !important;outline-offset:2px}.selected-section{outline:2px solid #10B981 !important;outline-offset:2px}*{cursor:pointer;}</style></head>
                    <body>${page.html}</body>
                    </html>`;
                previewIframe.srcdoc = fullHtml;
                previewIframe.onload = () => {
                    iframeDoc = previewIframe.contentDocument || previewIframe.contentWindow.document;
                    iframeDoc.body.addEventListener('click', e => { e.preventDefault(); e.stopPropagation(); handleElementSelection(e.target); });
                    lucide.createIcons({ context: iframeDoc });
                    currentPageNameEl.textContent = page.name;
                    renderPageList();
                    clearSelection();
                };
            }

            function addPage() {
                const pageName = prompt("Enter new page name:", `Page ${projectData.pages.length + 1}`);
                if (pageName) {
                    const newPageHtml = templates['blog'].html; // Default to a simple template
                    projectData.pages.push({ name: pageName, html: newPageHtml });
                    loadPage(projectData.pages.length - 1);
                }
            }

            function renderPageList() {
                pagesList.innerHTML = '';
                projectData.pages.forEach((page, index) => {
                    const isActive = index === projectData.currentPageIndex;
                    const pageEl = document.createElement('div');
                    pageEl.className = `p-2 rounded-lg flex justify-between items-center cursor-pointer ${isActive ? 'bg-blue-100 text-blue-700' : 'hover:bg-gray-100'}`;
                    pageEl.textContent = page.name;
                    pageEl.onclick = () => loadPage(index);
                    pagesList.appendChild(pageEl);
                });
            }

            function saveCurrentPage() {
                if (iframeDoc) {
                    const cleanHtml = iframeDoc.body.cloneNode(true);
                    cleanHtml.querySelectorAll('.selected-element, .selected-section').forEach(el => el.classList.remove('selected-element', 'selected-section'));
                    projectData.pages[projectData.currentPageIndex].html = cleanHtml.innerHTML;
                }
            }
            
            // --- TABS & SECTIONS ---
            function switchTab(tabName) {
                currentTab = tabName;
                document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                document.getElementById(`tab-content-${tabName}`).classList.remove('hidden');
                document.querySelector(`.tab-button[data-tab="${tabName}"]`).classList.add('active');
            }
            
            function selectSection(sectionTag) {
                clearSelection();
                const sectionEl = iframeDoc.querySelector(sectionTag);
                if (sectionEl) {
                    sectionEl.classList.add('selected-section');
                    selectedElement = sectionEl;
                    updatePropertiesPanel();
                    switchTab('edit');
                }
            }

            // --- ELEMENT SELECTION & PROPERTIES ---
            function handleElementSelection(element) {
                if (element === iframeDoc.body) return;
                clearSelection();
                selectedElement = element;
                selectedElement.classList.add('selected-element');
                updatePropertiesPanel();
                switchTab('edit');
            }
            
            function clearSelection() {
                if (selectedElement) {
                    selectedElement.classList.remove('selected-element', 'selected-section');
                }
                selectedElement = null;
                elementPropertiesPanel.innerHTML = '<div class="text-center p-4 bg-gray-50 rounded-lg"><p class="text-gray-500 mt-2">Click an element in the preview to edit.</p></div>';
            }

            function updatePropertiesPanel() {
                if (!selectedElement) { clearSelection(); return; }
                let propsHTML = `<div class="space-y-4"><h4 class="text-lg font-semibold">Editing: &lt;${selectedElement.tagName.toLowerCase()}&gt;</h4>`;
                // ... (Property input generation logic remains similar, but now calls saveCurrentPage() on input)
                propsHTML += `</div>`;
                elementPropertiesPanel.innerHTML = propsHTML;
            }

            // --- ELEMENT MANIPULATION ---
            function addNewElement(type) {
                if (!iframeDoc) return;
                let newElement;
                const iconClasses = "w-6 h-6 inline-block";
                switch(type) {
                    case 'h1': newElement = iframeDoc.createElement('h1'); newElement.textContent = 'New Heading'; newElement.className = 'text-4xl font-bold'; break;
                    case 'p': newElement = iframeDoc.createElement('p'); newElement.textContent = 'New paragraph.'; newElement.className = 'my-4'; break;
                    case 'img': newElement = iframeDoc.createElement('img'); newElement.src = 'https://placehold.co/600x400'; newElement.className = 'rounded-lg'; break;
                    case 'button': newElement = iframeDoc.createElement('button'); newElement.textContent = 'Click Me'; newElement.className = 'bg-blue-500 text-white font-bold py-2 px-4 rounded'; break;
                    case 'div': newElement = iframeDoc.createElement('div'); newElement.className = 'p-4 border my-4 min-h-[50px]'; break;
                    case 'search': newElement = iframeDoc.createElement('input'); newElement.type = 'search'; newElement.placeholder = 'Search...'; newElement.className = 'border rounded-lg p-2'; break;
                    case 'cart': newElement = iframeDoc.createElement('i'); newElement.dataset.lucide = 'shopping-cart'; newElement.className = iconClasses; break;
                    case 'user': newElement = iframeDoc.createElement('i'); newElement.dataset.lucide = 'user'; newElement.className = iconClasses; break;
                }
                if (newElement) {
                    (iframeDoc.querySelector('main') || iframeDoc.body).appendChild(newElement);
                    if (type === 'cart' || type === 'user') lucide.createIcons({ context: iframeDoc });
                    handleElementSelection(newElement);
                    saveCurrentPage();
                }
            }

            // --- EVENT LISTENERS ---
            function attachEventListeners() {
                document.getElementById('add-page-btn').addEventListener('click', addPage);
                document.querySelectorAll('.tab-button').forEach(b => b.addEventListener('click', () => switchTab(b.dataset.tab)));
                document.querySelectorAll('.section-selector').forEach(b => b.addEventListener('click', () => selectSection(b.dataset.section)));
                document.querySelectorAll('.add-element-btn').forEach(btn => btn.addEventListener('click', () => addNewElement(btn.dataset.type)));
                
                // Debounced save on property change
                elementPropertiesPanel.addEventListener('input', () => {
                    // ... (Logic to update element properties)
                    saveCurrentPage();
                });

                // ... (Export, Preview, and Chatbot listeners remain similar)
            }

            // --- START THE APP ---
            init();
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Website Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .template-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .template-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        #preview-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background-color: white;
        }
        .customization-panel {
            width: 350px;
        }
        .chatbot-container {
            width: 350px;
            height: 450px;
            transition: all 0.3s ease-in-out;
        }
        /* Style for the selected element in the iframe */
        .selected-element {
            outline: 2px dashed #3B82F6 !important;
            outline-offset: 2px;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 antialiased">

    <!-- Template Selection Screen -->
    <div id="template-selection" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-2xl p-8 max-w-5xl w-full">
            <h2 class="text-3xl font-bold text-center mb-2">Choose a Starting Point</h2>
            <p class="text-center text-gray-500 mb-8">Select a template to begin customizing your website.</p>
            <div id="template-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 overflow-y-auto max-h-[70vh] p-2">
                <!-- Templates will be injected here by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main Builder Interface -->
    <div id="builder-interface" class="hidden flex h-screen">
        <!-- Customization Panel -->
        <aside class="customization-panel bg-white p-6 shadow-lg overflow-y-auto flex flex-col">
            <h3 class="text-xl font-bold mb-6 text-gray-900">Customize</h3>
            
            <!-- Element Properties -->
            <div id="element-properties" class="flex-grow">
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                    <svg class="w-12 h-12 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 8.812a9.025 9.025 0 0112.728 0M2 2l2.086 2.086m0 0a9.025 9.025 0 0112.728 0M4.086 4.086a9.025 9.025 0 010 12.728m0 0L2 20l5.72-1.72m-3.72-3.72L20 2"></path></svg>
                    <p class="text-gray-500 mt-2">Click on any element in the preview to start editing its properties.</p>
                </div>
            </div>

            <hr class="my-6 border-t border-gray-200">

            <!-- Add Elements -->
            <div>
                <h4 class="text-lg font-semibold mb-4 text-gray-800">Add Elements</h4>
                <div class="grid grid-cols-2 gap-4">
                    <button class="add-element-btn bg-gray-200 hover:bg-gray-300 p-3 rounded-lg flex flex-col items-center transition-colors" data-type="h1"><strong>H1</strong><span>Heading</span></button>
                    <button class="add-element-btn bg-gray-200 hover:bg-gray-300 p-3 rounded-lg flex flex-col items-center transition-colors" data-type="p"><strong>P</strong><span>Paragraph</span></button>
                    <button class="add-element-btn bg-gray-200 hover:bg-gray-300 p-3 rounded-lg flex flex-col items-center transition-colors" data-type="img">üñºÔ∏è<span>Image</span></button>
                    <button class="add-element-btn bg-gray-200 hover:bg-gray-300 p-3 rounded-lg flex flex-col items-center transition-colors" data-type="button">üîò<span>Button</span></button>
                    <button class="add-element-btn bg-gray-200 hover:bg-gray-300 p-3 rounded-lg flex flex-col items-center transition-colors" data-type="search">üîç<span>Search</span></button>
                    <button class="add-element-btn bg-gray-200 hover:bg-gray-300 p-3 rounded-lg flex flex-col items-center transition-colors" data-type="div">üî≤<span>Container</span></button>
                </div>
            </div>
        </aside>

        <!-- Live Preview -->
        <main class="flex-1 flex flex-col bg-gray-200">
            <header class="bg-white shadow-md p-3 flex justify-between items-center z-10">
                <h2 class="text-lg font-semibold text-gray-800">Live Preview</h2>
                <div class="flex items-center space-x-2">
                    <button id="export-html-btn" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Export HTML</button>
                    <button id="preview-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Full Preview</button>
                </div>
            </header>
            <div class="flex-1 p-4">
                <div class="bg-white h-full shadow-lg rounded-lg overflow-hidden">
                    <iframe id="preview-iframe"></iframe>
                </div>
            </div>
        </main>

        <!-- AI Chatbot -->
        <div id="chatbot-toggle" class="fixed bottom-5 right-5 bg-blue-600 hover:bg-blue-700 text-white w-16 h-16 rounded-full flex items-center justify-center cursor-pointer shadow-lg transform hover:scale-110 transition-transform">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
        </div>
        <div id="chatbot-container" class="chatbot-container fixed bottom-24 right-5 bg-white rounded-lg shadow-xl hidden flex-col">
            <div class="bg-blue-600 text-white p-4 rounded-t-lg flex justify-between items-center">
                <h3 class="font-bold">AI Content Assistant</h3>
                <button id="close-chatbot" class="text-white">&times;</button>
            </div>
            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto bg-gray-50"></div>
            <div class="p-4 border-t">
                <div class="relative">
                    <input type="text" id="chat-input" class="w-full border rounded-lg p-2 pr-10" placeholder="Ask for content ideas...">
                    <button id="chat-send" class="absolute right-2 top-1/2 -translate-y-1/2 text-blue-500 hover:text-blue-700">‚û§</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- TEMPLATE DATA ---
            const templates = [
                { name: 'E-commerce Classic', category: 'E-commerce', html: `<nav class="bg-gray-800 text-white p-4"><div class="container mx-auto flex justify-between"><div>MyStore</div><div>Cart</div></div></nav><header class="bg-blue-500 text-white text-center p-20"><h1 class="text-5xl">New Arrivals</h1><p class="mt-4">Check out the latest collection</p></header><section class="p-10"><h2 class="text-3xl text-center mb-8">Featured Products</h2></section>` },
                { name: 'Modern Business', category: 'Business', html: `<nav class="bg-white shadow p-4"><div class="container mx-auto flex justify-between items-center"><div class="font-bold text-xl">BizCorp</div><div class="space-x-4"><a href="#">Home</a><a href="#">About</a><a href="#">Services</a></div></div></nav><header class="text-center py-24 bg-gray-100"><h1 class="text-4xl font-bold">Driving Your Business Forward</h1><p class="text-xl text-gray-600 mt-4">Innovative solutions for a dynamic world.</p><button class="mt-8 bg-blue-600 text-white py-3 px-6 rounded-lg">Learn More</button></header>` },
                { name: 'Minimalist Blog', category: 'Blog', html: `<header class="text-center py-16 border-b"><h1 class="text-5xl font-serif">The Minimalist</h1><p class="text-gray-500 mt-2">A blog about less.</p></header><main class="container mx-auto p-8"><article><h2>First Post Title</h2><p>This is the content of the first blog post...</p></article></main>` },
                { name: 'Creative Portfolio', category: 'Portfolio', html: `<main class="p-8"><h1 class="text-center text-4xl font-bold">Jane Doe</h1><p class="text-center text-xl text-gray-500">Creative Designer & Developer</p><section class="mt-16 grid grid-cols-3 gap-8"><div><img src="https://placehold.co/400x300/e2e8f0/333?text=Project+1" class="w-full h-auto rounded-lg"/></div><div><img src="https://placehold.co/400x300/e2e8f0/333?text=Project+2" class="w-full h-auto rounded-lg"/></div><div><img src="https://placehold.co/400x300/e2e8f0/333?text=Project+3" class="w-full h-auto rounded-lg"/></div></section></main>` },
                // Add 16 more diverse templates
                ...Array.from({ length: 16 }, (_, i) => ({ name: `Placeholder ${i + 1}`, category: 'Misc', html: `<h1>Template ${i + 5}</h1><p>Content for template ${i + 5}.</p>` }))
            ];

            // --- UI ELEMENT REFERENCES ---
            const templateGrid = document.getElementById('template-grid');
            const templateSelection = document.getElementById('template-selection');
            const builderInterface = document.getElementById('builder-interface');
            const previewIframe = document.getElementById('preview-iframe');
            const elementPropertiesPanel = document.getElementById('element-properties');
            
            let iframeDoc;
            let selectedElement = null;

            // --- INITIALIZATION ---
            function init() {
                populateTemplates();
                attachEventListeners();
            }

            function populateTemplates() {
                templates.forEach(template => {
                    const card = document.createElement('div');
                    card.className = 'template-card bg-white rounded-lg shadow-md overflow-hidden cursor-pointer border hover:border-blue-500';
                    card.innerHTML = `
                        <div class="bg-gray-200 h-32 flex items-center justify-center text-gray-500">Preview</div>
                        <div class="p-4">
                            <h3 class="font-semibold text-lg">${template.name}</h3>
                            <p class="text-gray-500 text-sm">${template.category}</p>
                        </div>
                    `;
                    card.addEventListener('click', () => selectTemplate(template.html));
                    templateGrid.appendChild(card);
                });
            }

            function selectTemplate(html) {
                templateSelection.classList.add('hidden');
                builderInterface.classList.remove('hidden');
                const fullHtml = `
                    <html>
                        <head>
                            <script src="https://cdn.tailwindcss.com"><\/script>
                            <style>
                                body { font-family: 'Inter', sans-serif; }
                                .selected-element { outline: 2px dashed #3B82F6 !important; outline-offset: 2px; cursor: pointer; }
                                * { cursor: pointer; }
                            </style>
                        </head>
                        <body class="p-4">${html}</body>
                    </html>
                `;
                previewIframe.srcdoc = fullHtml;
                previewIframe.onload = () => {
                    iframeDoc = previewIframe.contentDocument || previewIframe.contentWindow.document;
                    // Use event delegation on the body for robust element selection
                    iframeDoc.body.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        handleElementSelection(e.target);
                    });
                };
            }

            // --- ELEMENT SELECTION & PROPERTIES ---
            function handleElementSelection(element) {
                if (element === iframeDoc.body) return; // Don't select the body
                if (selectedElement) {
                    selectedElement.classList.remove('selected-element');
                }
                selectedElement = element;
                selectedElement.classList.add('selected-element');
                updatePropertiesPanel();
            }

            function updatePropertiesPanel() {
                if (!selectedElement) {
                    elementPropertiesPanel.innerHTML = '<p class="text-gray-500">Select an element to edit.</p>';
                    return;
                }

                let propertiesHTML = `<div class="space-y-4"><h4 class="text-lg font-semibold">Editing: &lt;${selectedElement.tagName.toLowerCase()}&gt;</h4>`;
                
                // Text content
                if (['H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'P', 'BUTTON', 'A', 'SPAN'].includes(selectedElement.tagName)) {
                    propertiesHTML += createTextarea('Text Content', selectedElement.innerHTML, (val) => selectedElement.innerHTML = val);
                }

                // Image source
                if (selectedElement.tagName === 'IMG') {
                    propertiesHTML += createInput('Image URL', selectedElement.src, (val) => selectedElement.src = val);
                    propertiesHTML += createInput('Alt Text', selectedElement.alt, (val) => selectedElement.alt = val);
                }

                // Link URL
                if (selectedElement.tagName === 'A') {
                    propertiesHTML += createInput('Link URL', selectedElement.href, (val) => selectedElement.href = val);
                }

                // Tailwind Classes
                propertiesHTML += createTextarea('Tailwind Classes', selectedElement.className, (val) => selectedElement.className = val);

                // Delete Button
                propertiesHTML += `<button id="delete-element-btn" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg mt-4">Delete Element</button></div>`;
                
                elementPropertiesPanel.innerHTML = propertiesHTML;

                // Add event listeners for the new inputs
                elementPropertiesPanel.querySelectorAll('input, textarea').forEach(input => {
                    input.addEventListener('input', (e) => {
                        const updateFn = window.propertyUpdateFns[e.target.dataset.property];
                        if (updateFn) updateFn(e.target.value);
                    });
                });

                document.getElementById('delete-element-btn').addEventListener('click', deleteSelectedElement);
            }
            
            // Helper to create property inputs
            window.propertyUpdateFns = {};
            let propIndex = 0;
            function createInput(label, value, onUpdate) {
                const propId = `prop_${propIndex++}`;
                window.propertyUpdateFns[propId] = onUpdate;
                return `<div><label class="block text-sm font-medium text-gray-700">${label}</label><input type="text" data-property="${propId}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2" value="${escapeHtml(value)}"></div>`;
            }
            function createTextarea(label, value, onUpdate) {
                const propId = `prop_${propIndex++}`;
                window.propertyUpdateFns[propId] = onUpdate;
                return `<div><label class="block text-sm font-medium text-gray-700">${label}</label><textarea data-property="${propId}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2" rows="3">${escapeHtml(value)}</textarea></div>`;
            }

            function escapeHtml(unsafe) {
                return unsafe.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
            }

            // --- ELEMENT MANIPULATION ---
            function addNewElement(type) {
                if (!iframeDoc) return;
                let newElement;
                switch(type) {
                    case 'h1': newElement = iframeDoc.createElement('h1'); newElement.textContent = 'New Heading'; newElement.className = 'text-4xl font-bold'; break;
                    case 'p': newElement = iframeDoc.createElement('p'); newElement.textContent = 'This is a new paragraph. Click to edit me!'; newElement.className = 'my-4'; break;
                    case 'img': newElement = iframeDoc.createElement('img'); newElement.src = 'https://placehold.co/600x400/e2e8f0/333?text=New+Image'; newElement.alt = 'Placeholder'; newElement.className = 'rounded-lg shadow-md'; break;
                    case 'button': newElement = iframeDoc.createElement('button'); newElement.textContent = 'Click Me'; newElement.className = 'bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded'; break;
                    case 'search': newElement = iframeDoc.createElement('input'); newElement.type = 'search'; newElement.placeholder = 'Search...'; newElement.className = 'border rounded-lg p-2'; break;
                    case 'div': newElement = iframeDoc.createElement('div'); newElement.className = 'p-4 border rounded-lg my-4 min-h-[50px]'; newElement.innerHTML = '<p class="text-gray-400">New Container</p>'; break;
                }
                if (newElement) {
                    (selectedElement && selectedElement.tagName === 'DIV' ? selectedElement : iframeDoc.body).appendChild(newElement);
                    handleElementSelection(newElement);
                }
            }

            function deleteSelectedElement() {
                if (selectedElement && selectedElement.parentElement) {
                    selectedElement.parentElement.removeChild(selectedElement);
                    selectedElement = null;
                    elementPropertiesPanel.innerHTML = '<p class="text-gray-500">Select an element to edit.</p>';
                }
            }

            // --- EVENT LISTENERS ---
            function attachEventListeners() {
                document.querySelectorAll('.add-element-btn').forEach(btn => btn.addEventListener('click', () => addNewElement(btn.dataset.type)));
                
                document.getElementById('preview-btn').addEventListener('click', () => {
                    if(iframeDoc) {
                        const previewHtml = new XMLSerializer().serializeToString(iframeDoc);
                        const previewWindow = window.open();
                        previewWindow.document.write(previewHtml);
                        previewWindow.document.close();
                    }
                });

                document.getElementById('export-html-btn').addEventListener('click', () => {
                    if(iframeDoc) {
                        const cleanHtml = iframeDoc.documentElement.cloneNode(true);
                        cleanHtml.querySelectorAll('.selected-element').forEach(el => el.classList.remove('selected-element'));
                        const htmlString = `<!DOCTYPE html>\n${cleanHtml.outerHTML}`;
                        const blob = new Blob([htmlString], { type: 'text/html' });
                        const a = document.createElement('a');
                        a.href = URL.createObjectURL(blob);
                        a.download = 'website.html';
                        a.click();
                        URL.revokeObjectURL(a.href);
                    }
                });

                // Chatbot listeners
                const chatbotToggle = document.getElementById('chatbot-toggle');
                const chatbotContainer = document.getElementById('chatbot-container');
                const closeChatbot = document.getElementById('close-chatbot');
                const chatInput = document.getElementById('chat-input');
                const chatSend = document.getElementById('chat-send');
                
                chatbotToggle.addEventListener('click', () => chatbotContainer.classList.toggle('hidden'));
                closeChatbot.addEventListener('click', () => chatbotContainer.classList.add('hidden'));
                chatSend.addEventListener('click', sendChatMessage);
                chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendChatMessage(); });
            }

            // --- CHATBOT ---
            const chatMessages = document.getElementById('chat-messages');
            const chatInput = document.getElementById('chat-input');

            function sendChatMessage() {
                const userMessage = chatInput.value.trim();
                if (userMessage === '') return;
                addChatMessage('user', userMessage);
                chatInput.value = '';
                getAIResponse(userMessage);
            }

            function addChatMessage(sender, message) {
                const messageElement = document.createElement('div');
                messageElement.className = `mb-3 flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
                messageElement.innerHTML = `<div class="inline-block p-3 rounded-lg max-w-xs ${sender === 'user' ? 'bg-blue-500 text-white' : 'bg-gray-200'}">${message}</div>`;
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function getAIResponse(query) {
                addChatMessage('ai', 'Thinking...');
                setTimeout(() => {
                    chatMessages.removeChild(chatMessages.lastChild); // Remove "Thinking..."
                    let response = "I can help with that. What kind of content do you need?";
                    if (query.toLowerCase().includes("business")) {
                        response = "For a business site, try adding a 'Testimonials' section. Here's some sample text: 'Our clients love us! Here is what they have to say...'";
                    } else if (query.toLowerCase().includes("blog post idea")) {
                        response = "How about a blog post on '5 Tips for Better Productivity'? It's a popular topic that engages a wide audience.";
                    } else if (query.toLowerCase().includes("portfolio")) {
                        response = "For a portfolio, create a compelling bio. Example: 'A passionate designer with a keen eye for detail, dedicated to creating unforgettable user experiences.'";
                    }
                    addChatMessage('ai', response);
                }, 1200);
            }

            // --- START THE APP ---
            init();
        });
    </script>
</body>
</html>
